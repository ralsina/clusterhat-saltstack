# compose.yml
version: "3"

services:
  dashboard:
    image: alexellis2/visualizer-arm:latest
    volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
    ports:
    - 8080:8080
    environment:
      PORT: 8080
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.labels.controller == true
      labels:
        # Expose via traefik
        - traefik.enable=true
        - traefik.docker.network=traefik-public
        - traefik-constraint-label=traefik-public

        # Accessible via HTTP and HTTPS
        - traefik.http.routers.dashboard.rule=Host(`dashboard.cluster`)
        - traefik.http.routers.dashboard.entrypoints=http,https

        # Proxy to port 8080
        - traefik.http.services.dashboard.loadbalancer.server.port=8080
    networks:  # Allow communication with traefik
      - traefik-public

networks:
  traefik-public:
    external: true
